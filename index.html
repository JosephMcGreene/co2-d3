<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CO2 Annual Cycle</title>
  </head>
  <body>
    <svg></svg>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script type="module">
      //Get CO2 data from API endpoint
      async function getCO2Data() {
        const { co2 } = await d3.json("https://global-warming.org/api/co2-api");
        return co2;
      }
      const data = await getCO2Data();

      // Format dates.
      const day = (year, month, day) => {
        return new Date(`${year} ${month} ${day}`);
      };

      // Declare the chart dimensions and margins.
      const width = 800;
      const height = 400;
      const marginTop = 20;
      const marginRight = 20;
      const marginBottom = 30;
      const marginLeft = 40;

      // Declare the x (horizontal position) scale.
      const x = d3
        .scaleTime()
        .domain(d3.extent(data, (d) => day(d.year, d.month, d.day)))
        .range([marginLeft, width - marginRight]);

      // Declare the y (vertical position) scale.
      const y = d3
        .scaleLinear()
        .domain([`${data[0].cycle}` - 5, 425])
        .range([height - marginBottom, marginTop]);

      // Select the SVG container.
      const svg = d3.select("svg").attr("width", width).attr("height", height);

      // Mount the x-axis.
      svg
        .append("g")
        .attr("transform", `translate(0, ${height - marginBottom})`)
        .call(d3.axisBottom(x));

      // Mount the y-axis.
      svg
        .append("g")
        .attr("transform", `translate(${marginLeft},0)`)
        .call(d3.axisLeft(y));

      // Mount the line.
      svg
        .append("path")
        .datum(data)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 2)
        .attr(
          "d",
          d3
            .line()
            .x((d) => x(day(d.year, d.month, d.day)))
            .y((d) => y(d.cycle))
        );

      d3.select(svg);

      // Append the SVG element.
      container.append(svg.node());
    </script>
  </body>
</html>
